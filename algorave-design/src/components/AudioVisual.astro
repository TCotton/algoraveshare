---
const {musicFile} = Astro.props;
console.log(musicFile);
---

<div class="waveform">
    <!-- the waveform will be rendered here -->
</div>

<script type="module">
    import WaveSurfer from 'https://cdn.jsdelivr.net/npm/wavesurfer.js@7/dist/wavesurfer.esm.js';

    const options = {
        /** HTML element or CSS selector (required) */
        container: 'div.waveform',
        /** The height of the waveform in pixels */
        height: 128,
        /** The width of the waveform in pixels or any CSS value; defaults to 100% */
        width: 100 + '%',
        /** Render each audio channel as a separate waveform */
        splitChannels: false,
        /** Stretch the waveform to the full height */
        normalize: false,
        /** The color of the waveform */
        waveColor: '#fab387',
        /** The color of the progress mask */
        progressColor: '#74c7ec',
        /** The color of the playback cursor */
        cursorColor: '#6c7086',
        /** The cursor width */
        cursorWidth: 5,
        /** Render the waveform with bars like this: ▁ ▂ ▇ ▃ ▅ ▂ */
        barWidth:  2,
        /** Spacing between bars in pixels */
        barGap: NaN,
        /** Rounded borders for bars */
        barRadius: NaN,
        /** A vertical scaling factor for the waveform */
        barHeight: NaN,
        /** Vertical bar alignment **/
        barAlign: '',
        /** Minimum pixels per second of audio (i.e. zoom level) */
        minPxPerSec: 1,
        /** Stretch the waveform to fill the container, true by default */
        fillParent: true,
        /** Audio URL */
        url: '/src/assets/music/sample-pentangle.wav',
        /** Whether to show default audio element controls */
        mediaControls: true,
        /** Play the audio on load */
        autoplay: false,
        /** Pass false to disable clicks on the waveform */
        interact: true,
        /** Allow to drag the cursor to seek to a new position */
        dragToSeek: false,
        /** Hide the scrollbar */
        hideScrollbar: false,
        /** Audio rate */
        audioRate: 1,
        /** Automatically scroll the container to keep the current position in viewport */
        autoScroll: true,
        /** If autoScroll is enabled, keep the cursor in the center of the waveform during playback */
        autoCenter: true,
        /** Decoding sample rate. Doesn't affect the playback. Defaults to 8000 */
        sampleRate: 8000,
    }

    const wavesurfer = WaveSurfer.create(options)

    wavesurfer.on('ready', () => {
        wavesurfer.setTime(10)
    })

    window.addEventListener("load", () => {
        const host = document.querySelector('.waveform > div');
        console.log(host);
        const sheet = new CSSStyleSheet;
        sheet.replaceSync( `.scroll { margin-bottom: 2lh }`);
        host.shadowRoot.adoptedStyleSheets.push(sheet);
    })

</script>